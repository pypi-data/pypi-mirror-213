<docs lang="markdown">
[TODO: write documentation for this plugin.]
</docs>

<config lang="json">
{
    "name": "ASGIWebPythonPlugin",
    "type": "web-python",
    "version": "0.1.0",
    "description": "[TODO: describe this plugin with one sentence.]",
    "tags": [],
    "ui": "",
    "cover": "",
    "inputs": null,
    "outputs": null,
    "flags": [],
    "icon": "extension",
    "api_version": "0.1.7",
    "env": "",
    "permissions": [],
    "requirements": ["fastapi==0.70.0"],
    "dependencies": [],
    "services": ["hello-fastapi"]
}
</config>

<script lang="python">
from imjoy_rpc import api
from fastapi import FastAPI

def create_fastapi_app():
    app = FastAPI()

    @app.get("/")
    async def root():
        return {"message": "Hello World"}

    return app


async def setup():
    # Registering fastapi app
    fastapi_app = create_fastapi_app()

    async def serve_fastapi(args):
        await fastapi_app(args["scope"], args["receive"], args["send"])

    await api.register_service({
        "id": "hello-fastapi",
        "type": "ASGI",
        "serve": serve_fastapi,
        "config": {
            "visibility": "public"
        }
    })

api.export({"setup": setup})
</script>
(this.webpackJsonpcartographer=this.webpackJsonpcartographer||[]).push([[0],{57:function(e,t,i){"use strict";i.r(t);var a=i(3),o=i(12),r=i(11),n=i.n(r),l=(i(52),i(16)),s=i.n(l),c=[{id:"fill-it",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":["get","user_color"],"fill-outline-color":"#000000","fill-opacity":.3}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000000","line-width":1}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":["get","user_color"]}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":["get","user_color"]}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],d=i(0),p=i(1),u=function(){function e(t,i,a,o,r,n,l,s,c,p){Object(d.a)(this,e),this.filename=t,this.height=i,this.width=a,this.src_crs=o,this.src_transform=r,this.crs=n,this.bounds=l,this.base_dir=s,this.transform=c,this.raster_type=p}return Object(p.a)(e,[{key:"__dict__",value:function(){return{filename:this.filename,height:this.height,width:this.width,crs:this.crs,src_crs:this.src_crs,src_transform:this.src_transform,bounds:this.bounds,base_dir:this.base_dir,transform:this.transform,raster_type:this.raster_type}}},{key:"png_filename",get:function(){return this.filename.replace(/\.[^/.]+$/,".png")}}]),e}(),w=function(){function e(){Object(d.a)(this,e),this.location=void 0,this.zoom=void 0,this.viewport_bounds=void 0,this.rasters=void 0,this.feature_collection=void 0,this.pointclouds=void 0,this.unique_labels=void 0,this.selected_label=void 0,this.location=[0,0],this.zoom=0,this.viewport_bounds=[0,0,0,0],this.rasters=[],this.feature_collection={type:"FeatureCollection",features:[]},this.pointclouds=[],this.unique_labels=[],this.selected_label=""}return Object(p.a)(e,[{key:"updateViewportFromMap",value:function(e){var t=e.unproject([1024,0]).toArray(),i=[e.unproject([0,660]).toArray(),t],a=e.unproject([512,330]).toArray();this.location=a,this.zoom=e.getZoom(),this.viewport_bounds=i.flat()}},{key:"__dict__",value:function(){return{location:this.location,zoom:this.zoom,viewport_bounds:this.viewport_bounds,rasters:this.rasters.map((function(e){return e.__dict__()})),feature_collection:this.feature_collection,pointclouds:this.pointclouds,unique_labels:this.unique_labels,selected_label:this.selected_label}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"initializeFromEvent",value:function(e){var t=e.args.cartographer_state;if(!t||!this.isValidCartographerData(t))throw new Error("USER CODE ERROR: Throwing because we received invalid data from the server"+JSON.stringify(t));var i=this.getInstance();i.location=t.location,i.zoom=t.zoom,i.viewport_bounds=t.viewport_bounds,i.rasters=t.rasters.map((function(e){return new u(e.filename,e.height,e.width,e.crs,e.src_crs,e.src_transform,e.bounds,e.base_dir,e.transform,e.raster_type)})),console.log(t.feature_collection),i.feature_collection=t.feature_collection,i.pointclouds=t.pointclouds,i.unique_labels=t.unique_labels,i.selected_label=t.selected_label}},{key:"isValidCartographerData",value:function(e){return e&&["location","zoom","viewport_bounds","rasters","feature_collection","pointclouds","unique_labels","selected_label"].every((function(t){return Object.prototype.hasOwnProperty.call(e,t)}))}}]),e}();w.instance=void 0;var f=function(){function e(t,i){Object(d.a)(this,e),this.sourceIds=void 0,this.map=void 0,this.container=void 0,this.sourceIds=t,this.map=i,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-top-left",this.createSliderOverlays()}return Object(p.a)(e,[{key:"createSliderOverlays",value:function(){var e=this,t={},i=document.createElement("div");i.className="map-overlay top",i.style.width="200px",this.sourceIds.forEach((function(a){var o=document.createElement("div");o.className="map-overlay-inner",o.style.display="block";var r=document.createElement("label");if(a.length<=20)r.textContent=a;else{var n=a.substring(0,20)+"...";r.textContent=n}r.title=a,r.style.display="flex";var l=document.createElement("input"),s="slider-"+a;l.id=s,l.type="range",l.min="0",l.max="100",l.step="1",console.log(a),a.startsWith("maxar")?l.value="100":l.value="40",l.style.width="100%",o.appendChild(r),o.appendChild(l),i.appendChild(o),t[s]=l,l.addEventListener("input",(function(t){console.log(window.map.getLayer(a).type);var i=t.target.value;"raster"===window.map.getLayer(a).type?e.map.setPaintProperty(a,"raster-opacity",parseInt(i,10)/100):"fill"===window.map.getLayer(a).type&&e.map.setPaintProperty(a,"fill-opacity",parseInt(i,10)/100)}))})),this.container.appendChild(i)}},{key:"addSourceId",value:function(e){this.sourceIds.push(e),this.createSliderOverlays()}},{key:"onAdd",value:function(){return this.container}},{key:"onRemove",value:function(){var e;null===(e=this.container.parentNode)||void 0===e||e.removeChild(this.container)}}]),e}(),y=i(2),m=i(6),h=i(4);function _(e,t,i){return v.apply(this,arguments)}function v(){return(v=Object(h.a)(Object(y.a)().mark((function e(t,i,a){var o,r,n,l,s;return Object(y.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=i.features,r=o.filter((function(e){return e.properties&&"mapillary_feature"===e.properties.type&&e.properties.description===a})),n={type:"FeatureCollection",features:r},(l=t.getSource(a))?l.setData(n):(console.log("adding source for "+a),console.log(n.features.length),t.addSource(a,{type:"geojson",data:n}),(s=new Image).onload=function(){t.addImage(a,s),t.addLayer({id:a+"-layer",type:"symbol",source:a,layout:{"icon-image":a,"icon-size":.15,"icon-allow-overlap":!0}})},s.src="http://localhost:3001/mapillary/"+a+".svg");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,i){var a,o=new Set,r=Object(m.a)(t);try{var n=function(){var t=a.value,r=e.getSource(t),n={type:"FeatureCollection",features:i.features.filter((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i.description)===t}))};if(0==n.features.length)return"continue";if(r)r.setData(n),o.add(t);else{var l;e.addSource(t,{type:"geojson",data:n});var s=null===(l=n.features[0].properties)||void 0===l?void 0:l.color;e.addLayer({id:t,type:"fill",source:t,paint:{"fill-color":s,"fill-opacity":.4},filter:["==","$type","Polygon"]})}o.add(t)};for(r.s();!(a=r.n()).done;)n()}catch(l){r.e(l)}finally{r.f()}return o}var b=i(5);function O(e){var t=["#FF6F40","#1CA953","#0077B6","#FFC300","#B7410E","#2F4F4F","#800080","#FF55A3"],i={};return e.forEach((function(e,a){i[e]=t[a%t.length]})),i}i(54).config(),n.a.accessToken=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).MAPBOX_API_KEY||"pk.eyJ1IjoibXdlaXNzMTAiLCJhIjoiY2xoajl0OGMxMGZwYTNnczZ2OTh1eXRreCJ9.ywUieENhWVdQP3hOP4Hycg",window.MAPILLARY_API_KEY=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).MAPILLARY_API_KEY||"MLY|6088287754621284|776bc701a5aebf616cb82964e04a6398";var E=!1;function S(){o.a.setComponentValue(window.state.__dict__())}function j(e,t){var i;e.addSource(t.png_filename,{type:"image",url:"http://localhost:8501/app/static/"+t.png_filename,coordinates:(i=t.bounds,[[i[0],i[3]],[i[2],i[3]],[i[2],i[1]],[i[0],i[1]]])}),"predicted_overlay"===t.raster_type?e.addLayer({id:t.png_filename,type:"raster",source:t.png_filename,paint:{"raster-fade-duration":0,"raster-opacity":.4}}):"base_satellite_image"===t.raster_type&&e.addLayer({id:t.png_filename,type:"raster",source:t.png_filename,paint:{"raster-fade-duration":0,"raster-opacity":1}}),window.sources.add(t.png_filename)}function C(e,t){!function(e){window.sources.forEach((function(t){"mapbox-dem"!==t&&"mapillary"!==t&&t.startsWith("prediction")&&(e.removeLayer(t),e.removeSource(t),window.sources.delete(t))}))}(e);for(var i=0;i<t.length;i++){var a=t[i];"predicted_overlay"===a.raster_type?(3===t.length&&2===i||2===t.length&&1===i)&&j(e,a):"base_satellite_image"!==a.raster_type||window.sources.has(a.png_filename)||j(e,a)}var o=t.map((function(e){return e.png_filename})),r=new f(o,e);e.addControl(r,"top-left"),window.state.updateViewportFromMap(e)}function P(e){var t=new n.a.Map({container:"map",style:"mapbox://styles/mapbox/satellite-streets-v12",center:new n.a.LngLat(e.location[0],e.location[1]),zoom:17});return window.map=t,window.draw=new s.a({displayControlsDefault:!1,controls:{},styles:c,userProperties:!0}),window.map.addControl(window.draw),window.map_initialized=!1,window.state.updateViewportFromMap(t),window.palette={},window.sources=new Set,window.draw_ctrl_visible=!1,t.on("load",(function(){E=!0,t.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),t.setTerrain({source:"mapbox-dem",exaggeration:1.5}),_(t,window.state.feature_collection,"object--support--utility-pole"),_(t,window.state.feature_collection,"object--sign--store"),C(t,window.state.rasters)})),window.palette=O(e.unique_labels),e.feature_collection.features.forEach((function(e){var t=window.palette[e.properties.description];e.properties=Object(b.a)(Object(b.a)({},e.properties),{},{color:t})})),t.on("draw.create",(function(e){console.log("draw.create"),e.features[0].type="Feature",e.features[0].properties={color:window.palette[window.state.selected_label],description:window.state.selected_label,type:"click"},window.draw.add(e.features[0]),window.state.feature_collection.features.push(e.features[0]),console.log(window.state.feature_collection.features),window.state.updateViewportFromMap(t);var i=g(window.map,window.state.unique_labels,window.state.feature_collection),o=window.state.rasters.map((function(e){return e.png_filename})),r=[].concat(Object(a.a)(o),Object(a.a)(Array.from(i))),n=new f(r,window.map);window.map.addControl(n,"top-left"),S()})),t.on("draw.update",(function(e){console.log("draw.update");var i=[].concat(Object(a.a)(window.draw.getAll().features),Object(a.a)(window.state.feature_collection.features));window.state.feature_collection.features=Array.from(new Set(i)),window.state.updateViewportFromMap(t),S()})),t.addControl(new n.a.ScaleControl({maxWidth:80,unit:"metric"}),"bottom-right"),t}o.a.events.addEventListener(o.a.RENDER_EVENT,(function(e){var t=e.detail;w.initializeFromEvent(t),window.state=w.getInstance(),window.palette=O(window.state.unique_labels),window.map_initialized||(window.map=P(window.state),window.map_initialized=!0),window.state.unique_labels.length>0&&!window.draw_ctrl_visible&&E&&(window.draw=function(){window.map.removeControl(window.draw);var e=new s.a({displayControlsDefault:!0,controls:{polygon:!0,trash:!0,combine_features:!1,uncombine_features:!1},styles:c,userProperties:!0});return window.map.addControl(e),e}(),window.draw_ctrl_visible=!0);for(var i=!1,o=0;o<window.state.rasters.length;o++){var r=window.state.rasters[o];window.sources.has(r.png_filename)||(i=!0)}if(E&&i&&C(window.map,window.state.rasters),E&&window.map_initialized&&window.state.feature_collection.features.length>0){var n=g(window.map,window.state.unique_labels,window.state.feature_collection),l=window.state.rasters.map((function(e){return e.png_filename})),d=[].concat(Object(a.a)(l),Object(a.a)(Array.from(n))),p=new f(d,window.map);window.map.addControl(p,"top-left")}})),o.a.setComponentReady(),o.a.setFrameHeight()}},[[57,1,2]]]);
//# sourceMappingURL=main.380fae73.chunk.js.map
(()=>{var ye=Object.defineProperty;var we=(t,e,n)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var H=(t,e,n)=>(we(t,typeof e!="symbol"?e+"":e,n),n);var oe=11;function Ee(t,e){var n=e.attributes,i,r,o,a,u;if(!(e.nodeType===oe||t.nodeType===oe)){for(var d=n.length-1;d>=0;d--)i=n[d],r=i.name,o=i.namespaceURI,a=i.value,o?(r=i.localName||r,u=t.getAttributeNS(o,r),u!==a&&(i.prefix==="xmlns"&&(r=i.name),t.setAttributeNS(o,r,a))):(u=t.getAttribute(r),u!==a&&t.setAttribute(r,a));for(var m=t.attributes,L=m.length-1;L>=0;L--)i=m[L],r=i.name,o=i.namespaceURI,o?(r=i.localName||r,e.hasAttributeNS(o,r)||t.removeAttributeNS(o,r)):e.hasAttribute(r)||t.removeAttribute(r)}}var W,Te="http://www.w3.org/1999/xhtml",_=typeof document=="undefined"?void 0:document,Se=!!_&&"content"in _.createElement("template"),Oe=!!_&&_.createRange&&"createContextualFragment"in _.createRange();function Ce(t){var e=_.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function Le(t){W||(W=_.createRange(),W.selectNode(_.body));var e=W.createContextualFragment(t);return e.childNodes[0]}function Ae(t){var e=_.createElement("body");return e.innerHTML=t,e.childNodes[0]}function Ne(t){return t=t.trim(),Se?Ce(t):Oe?Le(t):Ae(t)}function V(t,e){var n=t.nodeName,i=e.nodeName,r,o;return n===i?!0:(r=n.charCodeAt(0),o=i.charCodeAt(0),r<=90&&o>=97?n===i.toUpperCase():o<=90&&r>=97?i===n.toUpperCase():!1)}function ke(t,e){return!e||e===Te?_.createElement(t):_.createElementNS(e,t)}function Re(t,e){for(var n=t.firstChild;n;){var i=n.nextSibling;e.appendChild(n),n=i}return e}function Y(t,e,n){t[n]!==e[n]&&(t[n]=e[n],t[n]?t.setAttribute(n,""):t.removeAttribute(n))}var ae={OPTION:function(t,e){var n=t.parentNode;if(n){var i=n.nodeName.toUpperCase();i==="OPTGROUP"&&(n=n.parentNode,i=n&&n.nodeName.toUpperCase()),i==="SELECT"&&!n.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),n.selectedIndex=-1)}Y(t,e,"selected")},INPUT:function(t,e){Y(t,e,"checked"),Y(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var n=e.value;t.value!==n&&(t.value=n);var i=t.firstChild;if(i){var r=i.nodeValue;if(r==n||!n&&r==t.placeholder)return;i.nodeValue=n}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var n=-1,i=0,r=t.firstChild,o,a;r;)if(a=r.nodeName&&r.nodeName.toUpperCase(),a==="OPTGROUP")o=r,r=o.firstChild;else{if(a==="OPTION"){if(r.hasAttribute("selected")){n=i;break}i++}r=r.nextSibling,!r&&o&&(r=o.nextSibling,o=null)}t.selectedIndex=n}}},U=1,se=11,ce=3,le=8;function S(){}function xe(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function Pe(t){return function(n,i,r){if(r||(r={}),typeof i=="string")if(n.nodeName==="#document"||n.nodeName==="HTML"||n.nodeName==="BODY"){var o=i;i=_.createElement("html"),i.innerHTML=o}else i=Ne(i);else i.nodeType===se&&(i=i.firstElementChild);var a=r.getNodeKey||xe,u=r.onBeforeNodeAdded||S,d=r.onNodeAdded||S,m=r.onBeforeElUpdated||S,L=r.onElUpdated||S,$=r.onBeforeNodeDiscarded||S,g=r.onNodeDiscarded||S,M=r.onBeforeElChildrenUpdated||S,j=r.skipFromChildren||S,P=r.addChild||function(c,s){return c.appendChild(s)},k=r.childrenOnly===!0,v=Object.create(null),y=[];function b(c){y.push(c)}function D(c,s){if(c.nodeType===U)for(var h=c.firstChild;h;){var l=void 0;s&&(l=a(h))?b(l):(g(h),h.firstChild&&D(h,s)),h=h.nextSibling}}function I(c,s,h){$(c)!==!1&&(s&&s.removeChild(c),g(c),D(c,h))}function ne(c){if(c.nodeType===U||c.nodeType===se)for(var s=c.firstChild;s;){var h=a(s);h&&(v[h]=s),ne(s),s=s.nextSibling}}ne(n);function Q(c){d(c);for(var s=c.firstChild;s;){var h=s.nextSibling,l=a(s);if(l){var f=v[l];f&&V(s,f)?(s.parentNode.replaceChild(f,s),B(f,s)):Q(s)}else Q(s);s=h}}function me(c,s,h){for(;s;){var l=s.nextSibling;(h=a(s))?b(h):I(s,c,!0),s=l}}function B(c,s,h){var l=a(s);l&&delete v[l],!(!h&&(m(c,s)===!1||(t(c,s),L(c),M(c,s)===!1)))&&(c.nodeName!=="TEXTAREA"?ge(c,s):ae.TEXTAREA(c,s))}function ge(c,s){var h=j(c),l=s.firstChild,f=c.firstChild,R,w,x,G,E;e:for(;l;){for(G=l.nextSibling,R=a(l);!h&&f;){if(x=f.nextSibling,l.isSameNode&&l.isSameNode(f)){l=G,f=x;continue e}w=a(f);var q=f.nodeType,T=void 0;if(q===l.nodeType&&(q===U?(R?R!==w&&((E=v[R])?x===E?T=!1:(c.insertBefore(E,f),w?b(w):I(f,c,!0),f=E):T=!1):w&&(T=!1),T=T!==!1&&V(f,l),T&&B(f,l)):(q===ce||q==le)&&(T=!0,f.nodeValue!==l.nodeValue&&(f.nodeValue=l.nodeValue))),T){l=G,f=x;continue e}w?b(w):I(f,c,!0),f=x}if(R&&(E=v[R])&&V(E,l))h||P(c,E),B(E,l);else{var X=u(l);X!==!1&&(X&&(l=X),l.actualize&&(l=l.actualize(c.ownerDocument||_)),P(c,l),Q(l))}l=G,f=x}me(c,f,w);var ie=ae[c.nodeName];ie&&ie(c,s)}var p=n,F=p.nodeType,re=i.nodeType;if(!k){if(F===U)re===U?V(n,i)||(g(n),p=Re(n,ke(i.nodeName,i.namespaceURI))):p=i;else if(F===ce||F===le){if(re===F)return p.nodeValue!==i.nodeValue&&(p.nodeValue=i.nodeValue),p;p=i}}if(p===i)g(n);else{if(i.isSameNode&&i.isSameNode(p))return;if(B(p,i,k),y)for(var J=0,be=y.length;J<be;J++){var K=v[y[J]];K&&I(K,K.parentNode,!1)}}return!k&&p!==n&&n.parentNode&&(p.actualize&&(p=p.actualize(n.ownerDocument||_)),n.parentNode.replaceChild(p,n)),p}}var De=Pe(Ee),ue=De;var Z=function(t,e){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r])},Z(t,e)};function de(t,e){Z(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Ue(t){var e=typeof Symbol=="function"&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function Me(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,o=[],a;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(u){a={error:u}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o}function je(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Me(arguments[e]));return t}var fe=function(){function t(e,n){this.target=n,this.type=e}return t}(),Ie=function(t){de(e,t);function e(n,i){var r=t.call(this,"error",i)||this;return r.message=n.message,r.error=n,r}return e}(fe),Be=function(t){de(e,t);function e(n,i,r){n===void 0&&(n=1e3),i===void 0&&(i="");var o=t.call(this,"close",r)||this;return o.wasClean=!0,o.code=n,o.reason=i,o}return e}(fe);var Fe=function(){if(typeof WebSocket!="undefined")return WebSocket},Ge=function(t){return typeof t!="undefined"&&!!t&&t.CLOSING===2},A={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},qe=function(){function t(e,n,i){var r=this;i===void 0&&(i={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(o){r._debug("open event");var a=r._options.minUptime,u=a===void 0?A.minUptime:a;clearTimeout(r._connectTimeout),r._uptimeTimeout=setTimeout(function(){return r._acceptOpen()},u),r._ws.binaryType=r._binaryType,r._messageQueue.forEach(function(d){return r._ws.send(d)}),r._messageQueue=[],r.onopen&&r.onopen(o),r._listeners.open.forEach(function(d){return r._callEventListener(o,d)})},this._handleMessage=function(o){r._debug("message event"),r.onmessage&&r.onmessage(o),r._listeners.message.forEach(function(a){return r._callEventListener(o,a)})},this._handleError=function(o){r._debug("error event",o.message),r._disconnect(void 0,o.message==="TIMEOUT"?"timeout":void 0),r.onerror&&r.onerror(o),r._debug("exec error listeners"),r._listeners.error.forEach(function(a){return r._callEventListener(o,a)}),r._connect()},this._handleClose=function(o){r._debug("close event"),r._clearTimeouts(),r._shouldReconnect&&r._connect(),r.onclose&&r.onclose(o),r._listeners.close.forEach(function(a){return r._callEventListener(o,a)})},this._url=e,this._protocols=n,this._options=i,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(n,i){return typeof i=="string"?n+=i.length:i instanceof Blob?n+=i.size:n+=i.byteLength,n},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(e,n){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,n)},t.prototype.reconnect=function(e,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,n),this._connect())},t.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var n=this._options.maxEnqueuedMessages,i=n===void 0?A.maxEnqueuedMessages:n;this._messageQueue.length<i&&(this._debug("enqueue",e),this._messageQueue.push(e))}},t.prototype.addEventListener=function(e,n){this._listeners[e]&&this._listeners[e].push(n)},t.prototype.dispatchEvent=function(e){var n,i,r=this._listeners[e.type];if(r)try{for(var o=Ue(r),a=o.next();!a.done;a=o.next()){var u=a.value;this._callEventListener(e,u)}}catch(d){n={error:d}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return!0},t.prototype.removeEventListener=function(e,n){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(i){return i!==n}))},t.prototype._debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._options.debug&&console.log.apply(console,je(["RWS>"],e))},t.prototype._getNextDelay=function(){var e=this._options,n=e.reconnectionDelayGrowFactor,i=n===void 0?A.reconnectionDelayGrowFactor:n,r=e.minReconnectionDelay,o=r===void 0?A.minReconnectionDelay:r,a=e.maxReconnectionDelay,u=a===void 0?A.maxReconnectionDelay:a,d=0;return this._retryCount>0&&(d=o*Math.pow(i,this._retryCount-1),d>u&&(d=u)),this._debug("next delay",d),d},t.prototype._wait=function(){var e=this;return new Promise(function(n){setTimeout(n,e._getNextDelay())})},t.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var n=e();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")},t.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var n=this._options,i=n.maxRetries,r=i===void 0?A.maxRetries:i,o=n.connectionTimeout,a=o===void 0?A.connectionTimeout:o,u=n.WebSocket,d=u===void 0?Fe():u;if(this._retryCount>=r){this._debug("max retries reached",this._retryCount,">=",r);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!Ge(d))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(m){e._closeCalled||(e._debug("connect",{url:m,protocols:e._protocols}),e._ws=e._protocols?new d(m,e._protocols):new d(m),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},a))})}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new Ie(Error("TIMEOUT"),this))},t.prototype._disconnect=function(e,n){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,n),this._handleClose(new Be(e,n,this))}catch{}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(e,n){"handleEvent"in n?n.handleEvent(e):n(e)},t.prototype._removeListeners=function(){!this._ws||(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){!this._ws||(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}(),ee=qe;var z=JSON.parse(document.querySelector("meta[name=reactor-boost]")?.dataset.enabled||"false");console.log("BOOST_PAGES",z);function he(){if(z)for(let t of document.querySelectorAll("a[href]"))pe(t)}function pe(t){z&&t.tagName?.toLowerCase()==="a"&&t.hasAttribute("href")&&!(t.boosted||t.hasAttribute("onclick")||t.hasAttribute("target")||t.hasAttribute(":no-boost"))&&(t.boosted=!0,t.addEventListener("click",He))}function He(t){t.preventDefault();let e=t.target.tagName?.toLowerCase==="a"?t.target.href:t.target.closest("a").href;N.load(e)}function _e(t,e){console.log("replaceBodyContent",e);let n=document.createElement("html");n.innerHTML=t,window.requestAnimationFrame(()=>{e?.beforeReplace&&e.beforeReplace(n),document.body=n.querySelector("body"),he(),e?.afterReplace&&e.afterReplace(n),document.querySelector("[autofocus]")?.focus()})}function We(t){return t.startsWith("http://")||t.startsWith("https://")?new URL(t).origin===document.location.origin:!0}var te=class{static async load(e){z?(this._saveCurrentPage(),console.log(e),We(e)?(this.push(e),await this.restoreFromCurrentPath()):location.assign(e)):location.assign(e)}static async restoreFromCurrentPath(){this._saveCurrentPage();let e=window.location.pathname+window.location.search;console.log("Restoring Page:",e);let n=this._get(e);n&&(_e(n.content,{beforeReplace(){document.title=n.title},afterReplace(){window.scrollTo(0,n.scroll)}}),console.log("currentPath",e),this.currentPath=e);let i=await fetch(window.location.href),r=await i.text();this.replace(i.url),_e(r,{beforeReplace(o){document.title=o.querySelector("title")?.text??""},afterReplace(){te._saveCurrentPage()}})}static back(){window.history.back()}static push(e){history.pushState({},document.title,e),this.currentPath=e}static replace(e){history.replaceState({},document.title,e),this.currentPath=e}static _saveCurrentPage(){if(console.log("Saving page:",this.currentPath),this.cache=this.cache.filter(({url:e})=>e!=this.currentPath),this.cache.push({url:this.currentPath,content:document.body.outerHTML,title:document.title,scroll:window.scrollY}),this.cache.length>this.maxSize){let e=this.cache.shift();console.log("Evicted:",e.url)}console.log("Currently cached:",this.cache.map(({url:e})=>e))}static _get(e){return this.cache.find(n=>n.url==e)}},N=te;H(N,"maxSize",10),H(N,"cache",[]),H(N,"currentPath",window.location.pathname+window.location.search);window.addEventListener("popstate",t=>{N.restoreFromCurrentPath()});window.addEventListener("load",()=>{he()});var O={boostElement:pe,HistoryCache:N};var Ve=new DOMParser,ve=class extends EventTarget{open(e="__reactor__"){let n=location.protocol.replace("http","ws");this.socket=new ee(`${n}//${location.host}/${e}`,[],{maxEnqueuedMessages:0}),this.socket.addEventListener("open",()=>{console.log("WS: OPEN"),this.dispatchEvent(new Event("open"))}),this.socket.addEventListener("message",i=>this._processMessage(i)),this.socket.addEventListener("close",()=>{console.log("WS: CLOSE"),this.dispatchEvent(new Event("close"))})}get isOpen(){return this.socket?.readyState==ee.OPEN}_processMessage(e){let{command:n,payload:i}=JSON.parse(e.data);switch(n){case"render":var{id:r,diff:o}=i;console.log("<<< RENDER",r),document.getElementById(r)?.applyDiff(o);break;case"append":case"prepend":case"insert_after":case"insert_before":case"replace_with":var{id:r,html:a}=i;console.log(`<<< ${n.toUpperCase()}`,r),a=Ve.parseFromString(a,"text/html").body.firstChild;var u=document.getElementById(r);switch(n){case"append":u?.append(a);break;case"prepend":u?.prepend(a);break;case"insert_after":u?.after(a);break;case"insert_before":u?.before(a);break;case"replace_with":u?.replaceWith(a);break}break;case"remove":var{id:r}=i;console.log("<<< REMOVE",r),document.getElementById(r)?.remove();break;case"focus_on":var{selector:d}=i;console.log("<<< FOCUS-ON",`"${d}"`,document.querySelector(d)),window.requestAnimationFrame(()=>document.querySelector(d)?.focus());break;case"scroll_into_view":var{id:r,behavior:m,block:L,inline:$}=i;window.requestAnimationFrame(()=>document.getElementById(r)?.scrollIntoView({behavior:m,block:L,inline:$}));break;case"url_change":var{url:g}=i;switch(console.log("<< URL",i.command,g),i.command){case"redirect":O.HistoryCache.load(g);break;case"replace":O.HistoryCache.replace(g);break;case"push":O.HistoryCache.push(g);break}break;case"set_url_params":console.log("<< SET URL PARAMS",i);let M=document.location.search.slice(1),j={};M.length&&(j=M.split("&").map(v=>v.split("=")).reduce((v,y)=>{let[b,D]=y;return v[b]=D===void 0?void 0:decodeURIComponent(D),v},{}));let P=Object.entries(Object.assign(j,i)).map(v=>{let[y,b]=v;return y+(b===void 0?"":`=${encodeURIComponent(b)}`)}),k=document.location.pathname;P.length&&(k+="?"+P.join("&")),O.HistoryCache.replace(k);break;case"back":O.HistoryCache.back();break;default:console.error(`Unknown command "${n}"`,i)}}sendJoin(e,n,i){this._send("join",{name:e,parent_id:n,state:i})}sendLeave(e){console.log(">>> LEAVE",e),this._send("leave",{id:e})}sendUserEvent(e,n,i,r){console.log(">>> USER_EVENT",e,n,r),this._send("user_event",{id:e,command:n,implicit_args:i,explicit_args:r})}_send(e,n){this.isOpen&&this.socket.send(JSON.stringify({command:e,payload:n}))}},C=new ve;for({dataset}of document.querySelectorAll("meta[name=reactor-component]")){let t=document.createElement(dataset.extends);class e extends t.constructor{constructor(...i){super(...i);this._lastReceivedHtml=[],this.joinBind=()=>this.join(),this.wentOffline=()=>this.classList.add("reactor-disconnected")}connectedCallback(){C.addEventListener("open",this.joinBind),C.addEventListener("close",this.wentOffline),this.join()}disconnectedCallback(){C.removeEventListener("open",this.joinBind),C.removeEventListener("close",this.wentOffline),C.sendLeave(this.id)}join(){this.classList.remove("reactor-disconnected"),C.sendJoin(this.dataset.name,this.parentId,this.dataset.state)}applyDiff(i){let r=this.getHtml(i);window.requestAnimationFrame(()=>{ue(this,r,{onBeforeNodeAdded(o){O.boostElement(o)},onElUpdated(o){O.boostElement(o)}})})}getHtml(i){let r=[],o=0;for(let a of i)typeof a=="string"?r.push(a):a<0?o-=a:(r.push(...this._lastReceivedHtml.slice(o,o+a)),o+=a);return this._lastReceivedHtml=r,r.join(" ")}get parentId(){return this.parentComponent?.id}get parentComponent(){return this.parentElement?.closest("[reactor-component]")}dispatch(i,r,o){C.sendUserEvent(this.id,i,this.serialize(o),r)}serialize(i){let r={};for(let o of i.querySelectorAll("[name]")){if(o.closest("[reactor-component]")!==this)continue;let a=null;switch(o.type.toLowerCase()){case"checkbox":case"radio":a=o.checked?o.value||!0:null;break;case"select-multiple":a=o.selectedOptions.map(u=>u.value);break;default:a=o.value;break}if(a!==null){let u=o.getAttribute("name"),d=r[u]??[];d.push(a),r[u]=d}}return r}}customElements.define(dataset.tagName,e,{extends:dataset.extends})}C.open();debounceTimeouts={};window.reactor={send(t,e,n){let i=t.closest("[reactor-component]");if(i!==null){let r=t.closest("form"),o=i.contains(r)?r:i;i.dispatch(e,n,o)}},debounce(t,e){return n=>(...i)=>{clearTimeout(debounceTimeouts[t]),debounceTimeouts[t]=setTimeout(()=>n(...i),e)}}};})();
/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
//# sourceMappingURL=reactor.min.js.map

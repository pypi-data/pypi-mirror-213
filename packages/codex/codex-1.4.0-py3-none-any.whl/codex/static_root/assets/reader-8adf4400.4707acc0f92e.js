import{a as f,bo as u,b as v,c as m,o as d,e as h,w as l,j as p,t as k,bp as ue,bq as ge,g as n,D as P,A as T,f as y,C as S,ar as V,d as b,br as Fe,bs as He,i,aG as D,bn as pe,bt as Me,bu as Ge,bv as Ke,bw as qe,bx as _e,r as K,by as he,F as I,bz as me,M as q,bA as je,O as Ye,ba as Xe,R as j,be as Ze,bB as Je,bC as Qe,W as Y,bD as Z,bE as et,aK as X,bg as E,bd as tt,b4 as M,bF as ot,bG as at,bH as nt,bI as st,n as A,aH as rt,aZ as it,bJ as lt,L as ct,I as dt,J as L,au as G,a$ as J,aw as ut,ax as gt,bK as pt,bL as _t,bM as ht,bN as mt,bO as kt,l as Q,bP as bt,bQ as ke,bR as vt,bS as ft,bT as Pt,bU as ee,ac as St,bV as wt,bf as yt,bW as Ct,bX as te,bY as be,bZ as Rt,aD as F,b_ as Tt,b$ as It,c0 as Bt,c1 as Dt,c2 as Vt,c3 as $t,c4 as Lt,c5 as xt,c6 as Ot,c7 as Et,p as At,q as Nt,V as oe,bm as ve,B as ae,bl as Ut,c8 as Wt,bj as ne,c9 as zt}from"./admin-13961aa9.js";import{_ as N,a as fe,b as Pe,P as Ft,c as Se}from"./metadata-dialog-42d997e9.js";const Ht={name:"ReaderNavButton",components:{PaginationNavButton:N},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...f(u,{storePage:e=>e.page,vertical:e=>{var t;return(t=e.activeSettings)==null?void 0:t.vertical},toRoute(e){return{params:{pk:e.books.current.pk,page:this.value}}}}),title(){return"to page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...v(u,["setActivePage"]),onClick(){this.setActivePage(this.value,!0)}}};function Mt(e,t,o,c,r,a){const s=N;return e.vertical?(d(),h(s,{key:0,disabled:a.disabled,title:a.title,onClick:a.onClick},{default:l(()=>[p(k(o.value),1)]),_:1},8,["disabled","title","onClick"])):(d(),h(s,{key:1,disabled:a.disabled,title:a.title,to:e.toRoute},{default:l(()=>[p(k(o.value),1)]),_:1},8,["disabled","title","to"]))}const we=m(Ht,[["render",Mt]]),Gt={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:N},props:{direction:{type:String,required:!0}},computed:{...f(u,{toRoute(e){var o;const t=(o=e==null?void 0:e.routes)==null?void 0:o.books[this.direction];return t?{params:{...t}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.direction==="prev"?ue:ge},disabled(){return!this.toRoute}}};function Kt(e,t,o,c,r,a){const s=N;return d(),h(s,{icon:"",variant:"plain",disabled:a.disabled,title:a.title,to:e.toRoute},{default:l(()=>[n(P,null,{default:l(()=>[p(k(a.icon),1)]),_:1})]),_:1},8,["disabled","title","to"])}const ye=m(Gt,[["render",Kt]]),x="prev",O="next",qt={name:"ReaderNavToolbar",components:{PaginationSlider:fe,ReaderNavButton:we,PaginationToolbar:Pe,ReaderBookChangeNavButton:ye},computed:{...T(u,["activeSettings"]),...f(u,{storePage:e=>e.page,key(e){var t,o;return`${(o=(t=e.books)==null?void 0:t.current)==null?void 0:o.pk}:${this.twoPages}`},maxPage:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.maxPage)||0}}),twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},readInReverse(){return this.activeSettings.readInReverse},min(){return this.readInReverse?this.maxPage:0},max(){return this.readInReverse?0:this.maxPage},bookPrev(){return this.readInReverse?"next":"prev"},bookNext(){return this.readInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...v(u,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.activeSettings.vertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyListener(e){switch(e.stopPropagation(),e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(O):e.shiftKey&&window.scrollY===0&&this.routeToDirection(x);break;case"j":case"ArrowRight":this.routeToDirection(O);break;case"k":case"ArrowLeft":this.routeToDirection(x);break;case",":this.routeToDirectionOne(x);break;case".":this.routeToDirectionOne(O);break;case"n":this.routeToBook(O);break;case"p":this.routeToBook(x);break}}}};function jt(e,t,o,c,r,a){const s=ye,g=we,_=fe,C=Pe;return e.maxPage?(d(),h(C,{key:0},{default:l(()=>[n(s,{direction:a.bookPrev},null,8,["direction"]),n(g,{value:a.min,"two-pages":a.twoPages},null,8,["value","two-pages"]),(d(),h(_,{key:e.key,"model-value":e.storePage,min:0,max:e.maxPage,step:a.step,"track-color":a.trackColor,reverse:a.readInReverse,"onUpdate:modelValue":t[0]||(t[0]=B=>a.onSliderUpdate(B))},null,8,["model-value","max","step","track-color","reverse"])),n(g,{value:a.max,"two-pages":a.twoPages},null,8,["value","two-pages"]),n(s,{direction:a.bookNext},null,8,["direction"])]),_:1})):y("",!0)}const Ce=m(qt,[["render",jt]]);const Yt={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return this.prefetchLinks(this.params,this.computedDirection)},computed:{...f(u,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes[this.computedDirection]},directionClass(e){let t=this.direction;return e.activeSettings.vertical&&(t+="Vertical"),t},pageChangeClass(e){let t="pageChange";return t+=e.activeSettings.vertical?"Row":"Column",t}}),route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Page")}},methods:{...v(u,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function Xt(e,t,o,c,r,a){const s=S("router-link");return d(),h(s,{to:a.route,"aria-label":a.label,class:V({[e.pageChangeClass]:!0,[e.directionClass]:!0}),onClick:t[0]||(t[0]=g=>g.stopImmediatePropagation())},null,8,["to","aria-label","class"])}const Re=m(Yt,[["render",Xt],["__scopeId","data-v-4698e9bc"]]);const Zt={name:"LoadingPage",components:{Placeholder:Ft},props:{twoPages:{type:Boolean,required:!0}}};function Jt(e,t,o,c,r,a){const s=S("Placeholder");return d(),b("div",{class:V(["pageLoading",{twoPages:o.twoPages}])},[n(s,{class:"pagePlaceholder"})],2)}const Qt=m(Zt,[["render",Jt],["__scopeId","data-v-13c9bf0b"]]);const se="unauthorized",eo={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===se?"Protected page":"Failed to load page"},icon(){return this.type===se?Fe:He}}},to={class:"pageErrorContainer"},oo={class:"pageErrorText"};function ao(e,t,o,c,r,a){return d(),b("div",{class:V(["pageError",{twoPages:o.twoPages}])},[i("div",to,[i("div",oo,k(a.text),1),n(P,{class:"pageErrorIcon"},{default:l(()=>[p(k(a.icon),1)]),_:1})])],2)}const no=m(eo,[["render",ao],["__scopeId","data-v-3f1e3f4f"]]);const so={name:"ImgPage",props:{src:{type:String,required:!0},fitToClass:{type:Object,required:!0}},emits:["load","error"]},ro=["src"];function io(e,t,o,c,r,a){return d(),b("img",D({class:o.fitToClass,src:o.src},e.$attrs,{onError:t[0]||(t[0]=s=>e.$emit("error")),onLoad:t[1]||(t[1]=s=>e.$emit("load"))}),null,16,ro)}const re=m(so,[["render",io],["__scopeId","data-v-5997abff"]]);const ie=pe(Me(()=>qe(()=>import("./page-pdf-37cc28f6.js"),["assets/page-pdf-37cc28f6.js","assets/admin-13961aa9.js","assets/admin-beda768d.css","assets/page-pdf-2d7d4f5d.css"]))),lo=333,co={S:"Screen",W:"Width",H:"Height",O:"Original"},uo={name:"BookPage",components:{ErrorPage:no,LoadingPage:Qt,PDFPage:ie,ImgPage:re},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{pageClass(){return this.settings.vertical?"pageVertical":"pageHorizontal"},fitToClass(){let e={};const t=co[this.settings.fitTo];if(t){let o="fitTo";o+=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),this.settings.twoPages&&(o+="Two",this.settings.vertical&&(o+="Vertical")),e[o]=!0}return e},src(){const e={pk:this.book.pk,page:this.page};return Ge(e)},component(){return this.book.fileType==="PDF"?ie:re},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},lo)},methods:{...v(u,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},go=["id","data-page"];function po(e,t,o,c,r,a){const s=S("ErrorPage"),g=S("LoadingPage");return d(),b("div",{id:`page${o.page}`,"data-page":o.page,class:V(a.pageClass)},[r.error?(d(),h(s,{key:0,"two-pages":a.settings.twoPages,type:r.error},null,8,["two-pages","type"])):r.showProgress&&!r.loaded?(d(),h(g,{key:1,"two-pages":a.settings.twoPages},null,8,["two-pages"])):(d(),h(Ke(a.component),{key:2,src:a.src,"fit-to-class":a.fitToClass,book:o.book,onError:a.onError,onLoad:a.onLoad,onUnauthorized:a.onUnauthorized},null,40,["src","fit-to-class","book","onError","onLoad","onUnauthorized"]))],10,go)}const Te=m(uo,[["render",po],["__scopeId","data-v-f9e0354b"]]);const _o=48,ho=48,mo={name:"PagesHorizontalWindow",components:{BookPage:Te,PageChangeLink:Re},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...T(u,["isOnCoverPage"]),...f(u,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.books.current.pk}),settings(){return this.getSettings(this.book)},twoPages(){return this.settings.twoPages},readInReverse(){return this.settings.readInReverse},secondPage(){return this.settings.twoPages&&!this.isOnCoverPage},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),o=this.pages.at(-1);(e<t||e>o)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...v(u,["getSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-_o,0),t=Math.min(this.activePage+ho,this.book.maxPage),o=_e.range(e,t+1);this.pages=o}}};function ko(e,t,o,c,r,a){const s=Re,g=S("BookPage");return d(),h(me,{"show-arrows":"",continuous:"","model-value":a.windowIndex,reverse:a.readInReverse},{prev:l(()=>[n(s,{direction:"prev"})]),next:l(()=>[n(s,{direction:"next"})]),default:l(()=>[(d(!0),b(I,null,K(r.pages,_=>(d(),h(he,{key:`c/${o.book.pk}/${_}`,class:"windowItem",disabled:"",eager:_>=e.storePage-1&&_<=e.storePage+2,"model-value":_,transition:!0},{default:l(()=>[!a.readInReverse||a.secondPage&&_<o.book.maxPage?(d(),h(g,{key:0,book:o.book,page:a.readInReverse?_+1:_},null,8,["book","page"])):y("",!0),a.readInReverse||a.secondPage&&_<o.book.maxPage?(d(),h(g,{key:1,book:o.book,page:a.readInReverse?_:_+1},null,8,["book","page"])):y("",!0)]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const bo=m(mo,[["render",ko],["__scopeId","data-v-414dbdc4"]]);const vo=q({items:{type:Array,default:()=>[]},...je(),...Ye(),...Xe()},"VVirtualScroll"),fo=j()({name:"VVirtualScroll",props:vo(),setup(e,t){let{slots:o}=t;const{dimensionStyles:c}=Ze(e),{containerRef:r,handleScroll:a,handleItemResize:s,scrollToIndex:g,paddingTop:_,paddingBottom:C,computedItems:B}=Je(e,Qe(e,"items"));return Y(()=>n("div",{ref:r,class:["v-virtual-scroll",e.class],onScroll:a,style:[c.value,e.style]},[n("div",{class:"v-virtual-scroll__container",style:{paddingTop:Z(_.value),paddingBottom:Z(C.value)}},[B.value.map(R=>n(et,{key:R.index,dynamicHeight:!e.itemHeight,"onUpdate:height":$=>s(R.index,$)},{default:()=>{var $;return[($=o.default)==null?void 0:$.call(o,{item:R.raw,index:R.index})]}}))])])),{scrollToIndex:g}}});function Ie(e,t){const{self:o=!1}=t.modifiers??{},c=t.value,r=typeof c=="object"&&c.options||{passive:!0},a=typeof c=="function"||"handleEvent"in c?c:c.handler,s=o?e:t.arg?document.querySelector(t.arg):window;s&&(s.addEventListener("scroll",a,r),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:a,options:r,target:o?void 0:s})}function Be(e,t){var a;if(!((a=e._onScroll)!=null&&a[t.instance.$.uid]))return;const{handler:o,options:c,target:r=e}=e._onScroll[t.instance.$.uid];r.removeEventListener("scroll",o,c),delete e._onScroll[t.instance.$.uid]}function Po(e,t){t.value!==t.oldValue&&(Be(e,t),Ie(e,t))}const So={mounted:Ie,unmounted:Be,updated:Po},wo=12,le=250,ce={threshold:[.75]},yo={S:ce,H:ce},Co={name:"PagesVerticalScroller",components:{BookPage:Te},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1}},computed:{...f(u,{storePage:e=>e.page}),...X(u,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var o;const e=((o=this.book)==null?void 0:o.maxPage)+1,t=_e.range(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,wo)},intersectOptions(){return yo[this.settings.fitTo]}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},le)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...v(u,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const c=+t[0].target.dataset.page;this.setActivePage(c,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const o=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=o&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find vertcalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},le)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},Ro=["data-page"];function To(e,t,o,c,r,a){const s=S("BookPage");return E((d(),h(fo,{id:"verticalScroll",ref:"verticalScroll",items:a.items,height:r.innerHeight,width:r.innerWidth},{default:l(({item:g})=>[n(s,{book:o.book,page:g},null,8,["book","page"]),E(i("div",{class:"pageTracker","data-page":g},null,8,Ro),[[tt,{handler:a.onIntersect,options:a.intersectOptions},void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[So,a.onScroll,"#verticalScroll"]])}const Io=m(Co,[["render",To],["__scopeId","data-v-c5c4cded"]]),Bo={name:"PagesView",components:{PagesHorizontalWindow:bo,PagesVerticalScroller:Io},props:{book:{type:Object,required:!0}},emits:["click"],computed:{...f(u,{storePk:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.pk)||0}}),settings(){return this.getSettings(this.book)},vertical(){return this.settings.vertical}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page,!0)},methods:{...v(u,["getSettings","setActivePage"])}};function Do(e,t,o,c,r,a){const s=S("PagesVerticalScroller"),g=S("PagesHorizontalWindow");return a.vertical?(d(),h(s,{key:0,book:o.book,onClick:e.$emit.click},null,8,["book","onClick"])):(d(),h(g,{key:1,book:o.book,onClick:e.$emit.click},null,8,["book","onClick"]))}const De=m(Bo,[["render",Do]]);const Vo={name:"BookChangeActivator",props:{direction:{type:String,required:!0}},computed:{...T(u,["prevBookChangeShow","nextBookChangeShow"]),show(){return this[this.computedDirection+"BookChangeShow"]},computedDirection(){return this.normalizeDirection(this.direction)}},methods:{...v(u,["setBookChangeFlag","normalizeDirection"])}};function $o(e,t,o,c,r,a){return a.show?(d(),b("div",{key:0,class:V(["bookChangeColumn",{[o.direction]:!0}]),onClick:t[0]||(t[0]=M(s=>e.setBookChangeFlag(o.direction),["stop"]))},null,2)):y("",!0)}const Ve=m(Vo,[["render",$o],["__scopeId","data-v-2a8ea6a5"]]);const Lo={name:"BooksWindow",components:{BookChangeActivator:Ve,PagesView:De},emits:["click"],computed:{...f(u,{books:e=>[e.books.prev,e.books.current,e.books.next].filter(Boolean),bookChange:e=>e.bookChange,currentBookPk:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.pk)||0},bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag()},created(){this.loadBooks(this.$route.params)},methods:{...v(u,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function xo(e,t,o,c,r,a){const s=Ve,g=De;return d(),h(me,{id:"booksWindow",direction:"vertical","model-value":e.currentBookPk,"show-arrows":"",onClick:a.click},{prev:l(()=>[n(s,{direction:"prev"})]),next:l(()=>[n(s,{direction:"next"})]),default:l(()=>[(d(!0),b(I,null,K(e.books,_=>(d(),h(he,{key:`c/${_.pk}`,class:"windowItem",disabled:"",eager:a.eager(_.pk),value:_.pk,transition:!0},{default:l(()=>[n(g,{book:_,onClick:a.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","onClick"])}const $e=m(Lo,[["render",xo],["__scopeId","data-v-cb7fba11"]]);const Oo={a:at,f:nt,s:st},Eo={a:"Story Arc",f:"Folder",s:"Series"},Ao={name:"ReaderArcSelect",computed:{...f(u,{arcGroup:e=>{var t;return((t=e.arc)==null?void 0:t.group)||"s"},arcName:e=>{for(const t of e.arcs)if(e.arc.group===t.group&&e.arc.pk===t.pk)return t.name;return"Unknown"},arcKey:e=>`${e.arc.group}:${e.arc.pk}`,arcItems:e=>{const t=[];for(const o of e.arcs){const c={value:`${o.group}:${o.pk}`,title:o.name,group:o.group};t.push(c)}return t},arcPosition:function(e){const t=e.arc;return t&&t.index&&t.count?`${t.index}/${t.count}`:""}}),arc:{get(){return this.arcKey},set(e){const t=this.$route.params;if(!t)return;const[o,c]=e.split(":"),r={...t,arcGroup:o,arcPk:c};this.loadBooks(r)}}},methods:{...v(u,["loadBooks"]),arcIcon(e){return Oo[e]},arcLabel(e){return Eo[e]},checkIcon(e){return e===this.arc?ot:""}}},No={key:2,id:"arcPosition"};function Uo(e,t,o,c,r,a){return d(),b(I,null,[e.arcItems.length>1?(d(),h(rt,{key:0,modelValue:a.arc,"onUpdate:modelValue":t[0]||(t[0]=s=>a.arc=s),class:"arcSelect",density:"compact","hide-details":"auto",label:"Order",variant:"plain",items:e.arcItems},{item:l(({item:s,props:g})=>[n(A,D(g,{density:"compact",variant:"plain","prepend-icon":a.arcIcon(s.raw.group),subtitle:a.arcLabel(s.raw.group),"append-icon":a.checkIcon(g.value)}),null,16,["prepend-icon","subtitle","append-icon"])]),selection:l(({item:s,props:g})=>[n(A,D(g,{density:"compact",variant:"plain"}),{default:l(()=>[n(P,null,{default:l(()=>[p(k(a.arcIcon(s.raw.group)),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items"])):(d(),h(P,{key:1,id:"onlyArc",title:e.arcName},{default:l(()=>[p(k(a.arcIcon(e.arcGroup)),1)]),_:1},8,["title"])),e.arcPosition?(d(),b("span",No,k(e.arcPosition),1)):y("",!0)],64)}const Le=m(Ao,[["render",Uo],["__scopeId","data-v-bb646eeb"]]);const Wo={name:"ReaderTitleToolbar",components:{MetadataDialog:Se,ReaderArcSelect:Le,SettingsDrawerButton:it},data(){return{mdiClose:lt,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...T(u,["activeTitle"]),...f(u,{vertical:e=>e.activeSettings.vertical,pk:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.pk)||0}}),...f(ct,{lastRoute:e=>e.page.routes.last}),...X(L,["isSettingsDrawerOpen"]),closeBookRoute:function(){const e={name:"browser",params:this.lastRoute};return e.params?e.hash=`#card-${this.pk}`:e.params=window.CODEX.LAST_ROUTE||dt.browser.route,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...v(L,["setTimestamp"]),...v(u,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyListener(e){switch(e.stopPropagation(),e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.openMetadata();break}}}},zo={key:0};function Fo(e,t,o,c,r,a){const s=Le,g=Se,_=S("SettingsDrawerButton");return d(),h(gt,{id:"readerTopToolbar",class:"codexToolbar",density:"compact"},{default:l(()=>[n(J,null,{default:l(()=>[n(G,{id:"closeBook",ref:"closeBook",to:a.closeBookRoute,size:"large",onClick:a.onCloseBook},{default:l(()=>[e.$vuetify.display.smAndDown?(d(),h(P,{key:1,title:"Close Book"},{default:l(()=>[p(k(r.mdiClose),1)]),_:1})):(d(),b("span",zo,"close book"))]),_:1},8,["to","onClick"])]),_:1}),n(ut,{id:"toolbarTitle",class:"codexToolbarTitle"},{default:l(()=>[p(k(e.activeTitle),1)]),_:1}),n(J,null,{default:l(()=>[n(s),n(G,{id:"tagButton",onClick:M(a.openMetadata,["stop"])},{default:l(()=>[n(g,{ref:"metadataDialog",group:"c",pk:e.pk},null,8,["pk"])]),_:1},8,["onClick"]),n(_,{id:"settingsButton",onClick:t[0]||(t[0]=M(C=>e.isSettingsDrawerOpen=!0,["stop"]))})]),_:1})]),_:1})}const xe=m(Wo,[["render",Fo],["__scopeId","data-v-68e8b1fe"]]);const Ho={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){if(this.isDrawerOpen)return this.prefetchLinks(this.params,this.computedDirection,!0)},computed:{...T(u,["prevBookChangeShow","nextBookChangeShow"]),...f(u,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes.books[this.computedDirection]},isDrawerOpen(e){return e.bookChange===this.computedDirection},icon(){return this.computedDirection==="next"?ge:ue}}),show(){return this[this.computedDirection+"BookChangeShow"]},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Book")}},methods:{...v(u,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function Mo(e,t,o,c,r,a){const s=S("router-link");return a.show?(d(),h(pt,{key:0,class:V({bookChangeDrawer:!0,[o.direction]:!0}),"disable-resize-watcher":"","disable-route-watcher":"",location:e.computedDirection==="prev"?"left":"right","model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:l(()=>[n(s,{class:"navLink",to:a.route,"aria-label":a.label,title:a.label,onClick:t[0]||(t[0]=g=>g.stopImmediatePropagation())},{default:l(()=>[n(P,{class:"bookChangeIcon"},{default:l(()=>[p(k(e.icon),1)]),_:1})]),_:1},8,["to","aria-label","title"])]),_:1},8,["class","location","model-value"])):y("",!0)}const Oe=m(Ho,[["render",Mo],["__scopeId","data-v-bc37f6d5"]]);const Go={name:"DownloadPanel",data(){return{mdiDownload:_t,mdiFileImage:ht}},computed:{...T(u,["activeTitle","routeParams"]),...f(u,{storePage:e=>e.page,filename:e=>{var t,o;return(o=(t=e.books)==null?void 0:t.current)==null?void 0:o.filename},downloadURL(e){return mt(e.books.current.pk)}}),pageSrc(){return kt(this.routeParams)},pageName(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{...v(L,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.filename)}}},Ko={id:"downloadPanel"};function qo(e,t,o,c,r,a){return d(),b("div",Ko,[n(A,{onClick:a.downloadPage},{default:l(()=>[n(Q,null,{default:l(()=>[n(P,null,{default:l(()=>[p(k(r.mdiFileImage),1)]),_:1}),p("Download Page "+k(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),n(A,{onClick:a.downloadBook},{default:l(()=>[n(Q,null,{default:l(()=>[n(P,null,{default:l(()=>[p(k(r.mdiDownload),1)]),_:1}),p("Download Book ")]),_:1})]),_:1},8,["onClick"])])}const Ee=m(Go,[["render",qo],["__scopeId","data-v-52aba7d6"]]);const jo=q({...bt({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),H=j()({name:"VRadio",props:jo(),setup(e,t){let{slots:o}=t;return Y(()=>n(ke,D(e,{class:["v-radio",e.class],style:e.style,type:"radio"}),o)),{}}});const Yo=q({height:{type:[Number,String],default:"auto"},...vt(),...ft(Pt(),["multiple"]),trueIcon:{type:ee,default:"$radioOn"},falseIcon:{type:ee,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),de=j()({name:"VRadioGroup",inheritAttrs:!1,props:Yo(),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const r=St(),a=wt(()=>e.id||`radio-group-${r}`),s=yt(e,"modelValue");return Y(()=>{const[g,_]=Ct(o),[C,B]=te.filterProps(e),[R,$]=ke.filterProps(e),U=c.label?c.label({label:e.label,props:{for:a.value}}):e.label;return n(te,D({class:["v-radio-group",e.class],style:e.style},g,C,{modelValue:s.value,"onUpdate:modelValue":W=>s.value=W,id:a.value}),{...c,default:W=>{let{id:z,messagesId:Ne,isDisabled:Ue,isReadonly:We}=W;return n(I,null,[U&&n(be,{id:z.value},{default:()=>[U]}),n(Rt,D(R,{id:z.value,"aria-describedby":Ne.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:Ue.value,readonly:We.value,"aria-labelledby":U?z.value:void 0,multiple:!1},_,{modelValue:s.value,"onUpdate:modelValue":ze=>s.value=ze}),c)])}})}),{}}}),Xo=["fitTo","twoPages","vertical","readInReverse"],Zo={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1}},computed:{...f(u,{fitToChoices(e){const t=[];for(const o of e.choices.fitTo)o.value&&t.push(o);return t},selectedSettings(e){var t,o;return this.isGlobalScope||!((t=e.books)!=null&&t.current)?e.readerSettings:(o=e.books)==null?void 0:o.current.settings},isClearSettingsButtonDisabled(e){var t,o;if(this.isGlobalScope||!((t=e.books)!=null&&t.current))return!0;for(const c of Xo){const r=(o=e.books)==null?void 0:o.current.settings[c];if(!e.choices.nullValues.has(r))return!1}return!0},verticalLabel(e){var o,c,r;const t=(o=e.books)!=null&&o.current&&((c=e.books)!=null&&c.current.settings)?(r=e.books)==null?void 0:r.current.settings.vertical:void 0;return t==null?"Horizontal or Vertical":t?"Scroll Pages Vertically":"Turn Pages Horizontally"}}),...X(u,["readRTLInReverse"])},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...v(u,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal"]),settingsDialogChanged(e){this.isGlobalScope?this.setSettingsGlobal(e):this.setSettingsLocal(e)},_keyListener(e){e.stopPropagation();let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"r":t={readInReverse:!this.selectedSettings.readInReverse};break;case"v":t={vertical:!this.selectedSettings.vertical}}t&&this.setSettingsLocal(t)}}},Jo={id:"readerSettings"};function Qo(e,t,o,c,r,a){return d(),b("div",Jo,[n(de,{modelValue:r.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=s=>r.isGlobalScope=s),density:"compact",label:"Scope","hide-details":"auto"},{default:l(()=>[n(H,{label:"Only this comic",value:!1}),n(H,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),n(de,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=s=>a.settingsDialogChanged({fitTo:s}))},{default:l(()=>[(d(!0),b(I,null,K(e.fitToChoices,s=>(d(),h(H,{key:s.value,label:s.title,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(F,{disabled:e.selectedSettings.vertical,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=s=>a.settingsDialogChanged({twoPages:s}))},null,8,["disabled","model-value","indeterminate"]),n(be,null,{default:l(()=>[p("Reading Direction")]),_:1}),n(Tt,{class:"vertical",density:"compact",label:e.verticalLabel,"hide-details":"auto","model-value":e.selectedSettings.vertical,"true-value":!0,indeterminate:e.selectedSettings.vertical===null||e.selectedSettings.vertical===void 0,"onUpdate:modelValue":t[3]||(t[3]=s=>a.settingsDialogChanged({vertical:s}))},null,8,["label","model-value","indeterminate"]),n(F,{class:"readInReverse",density:"compact",label:"Read in Reverse","hide-details":"auto","model-value":e.selectedSettings.readInReverse,"true-value":!0,indeterminate:e.selectedSettings.readInReverse===null||e.selectedSettings.readInReverse===void 0,"onUpdate:modelValue":t[4]||(t[4]=s=>a.settingsDialogChanged({readInReverse:s}))},null,8,["model-value","indeterminate"]),r.isGlobalScope?(d(),h(F,{key:0,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL comics in Reverse","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=s=>a.settingsDialogChanged({readRtlInReverse:s}))},null,8,["model-value"])):y("",!0),r.isGlobalScope?y("",!0):(d(),h(G,{key:1,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:e.clearSettingsLocal},{default:l(()=>[p(" Clear Comic Settings ")]),_:1},8,["disabled","onClick"]))])}const Ae=m(Zo,[["render",Qo],["__scopeId","data-v-057c896c"]]);const ea={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:It,mdiMenuRight:Bt,mdiKeyboardOutline:Dt,mdiKeyboardSpace:Vt,mdiAppleKeyboardShift:$t}},computed:{...T(L,["isMobile"])}},w=e=>(At("data-v-41483eb9"),e=e(),Nt(),e),ta=w(()=>i("h4",null,"Navigation",-1)),oa={class:"highlight-table"},aa=w(()=>i("td",null,"Previous page",-1)),na=w(()=>i("td",null,"Next page",-1)),sa=w(()=>i("tr",null,[i("td",null,","),i("td",null,[p("Next "),i("em",null,"only"),p(" one page in two page mode.")])],-1)),ra=w(()=>i("tr",null,[i("td",null,"."),i("td",null,[p("Previous "),i("em",null,"only"),p(" one page in two page mode.")])],-1)),ia=w(()=>i("tr",null,[i("td",null,"p"),i("td",null,"Previous Book")],-1)),la=w(()=>i("tr",null,[i("td",null,"n"),i("td",null,"Next Book")],-1)),ca=w(()=>i("h4",null,"Fit Page To",-1)),da=w(()=>i("table",{class:"highlight-table"},[i("tbody",null,[i("tr",null,[i("td",null,"s"),i("td",null,"screen")]),i("tr",null,[i("td",null,"h"),i("td",null,"screen height")]),i("tr",null,[i("td",null,"w"),i("td",null,"screen width")]),i("tr",null,[i("td",null,"o"),i("td",null,"Show page at original size")]),i("tr",null,[i("td",null,"2"),i("td",null,"Toggle two page view")]),i("tr",null,[i("td",null,"r"),i("td",null,"Toggle Read in Reverse")])])],-1)),ua=w(()=>i("h4",null,"Other",-1)),ga=w(()=>i("table",{class:"highlight-table"},[i("tbody",null,[i("tr",null,[i("td",null,"m"),i("td",null,"Show comic's metadata")]),i("tr",null,[i("td",null,"esc"),i("td",null,"Close book")])])],-1));function pa(e,t,o,c,r,a){return e.isMobile?y("",!0):(d(),h(Et,{key:0},{default:l(()=>[n(Lt,{id:"readerKeyboardShortcuts"},{default:l(()=>[n(xt,{id:"shortcutsTitle"},{default:l(()=>[n(P,{id:"keyboardIcon"},{default:l(()=>[p(k(r.mdiKeyboardOutline),1)]),_:1}),p("Keyboard Shortcuts ")]),_:1}),n(Ot,null,{default:l(()=>[ta,i("table",oa,[i("tbody",null,[i("tr",null,[i("td",null,[n(P,{class:"keyIcon",density:"compact"},{default:l(()=>[p(k(r.mdiMenuLeft),1)]),_:1}),p(", j, "),i("div",null,[n(P,{class:"keyIcon",density:"compact"},{default:l(()=>[p(k(r.mdiAppleKeyboardShift),1)]),_:1}),n(P,{class:"keyIcon",density:"compact"},{default:l(()=>[p(k(r.mdiKeyboardSpace),1)]),_:1})])]),aa]),i("tr",null,[i("td",null,[n(P,{class:"keyIcon",density:"compact"},{default:l(()=>[p(k(r.mdiMenuRight),1)]),_:1}),p(", k, "),n(P,{class:"keyIcon",density:"compact"},{default:l(()=>[p(k(r.mdiKeyboardSpace),1)]),_:1})]),na]),sa,ra,ia,la])]),ca,da,ua,ga]),_:1})]),_:1})]),_:1}))}const _a=m(ea,[["render",pa],["__scopeId","data-v-41483eb9"]]),ha={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:Ee,ReaderKeyboardShortcutsPanel:_a,ReaderSettingsPanel:Ae}};function ma(e,t,o,c,r,a){const s=Ae,g=S("ReaderKeyboardShortcutsPanel"),_=Ee;return d(),b(I,null,[n(s),n(oe),n(g),n(oe),n(_)],64)}const ka=m(ha,[["render",ma]]);const ba={name:"MainReader",components:{BookChangeDrawer:Oe,BooksWindow:$e,ReaderNavToolbar:Ce,ReaderTitleToolbar:xe,SettingsDrawer:ve},data(){return{showToolbars:!1,ReaderSettingsSuperPanel:pe(ka)}},computed:{...T(ae,["isCodexViewable"]),...f(ae,{user:e=>e.user})},watch:{user(){this.loadReaderSettings()},isCodexViewable(){this.loadReaderSettings()}},created(){L().isSettingsDrawerOpen=!1,this.loadReaderSettings()},methods:{...v(u,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},va={key:0,id:"readerContainer"},fa={key:1,id:"announcement"};function Pa(e,t,o,c,r,a){const s=Oe,g=xe,_=$e,C=Ce,B=S("router-link"),R=ve;return d(),b(I,null,[n(Ut,{id:"readerWrapper"},{default:l(()=>[n(s,{direction:"prev"}),e.isCodexViewable?(d(),b("div",va,[n(Wt,null,{default:l(()=>[E(n(g,null,null,512),[[ne,r.showToolbars]])]),_:1}),n(_,{onClick:a.toggleToolbars},null,8,["onClick"]),n(zt,null,{default:l(()=>[E(n(C,null,null,512),[[ne,r.showToolbars]])]),_:1})])):(d(),b("div",fa,[i("h1",null,[n(B,{to:{name:"home"}},{default:l(()=>[p(" Log in ")]),_:1}),p(" to read comics ")])]))]),_:1}),n(s,{direction:"next"}),n(R,{title:"Reader Settings",panel:r.ReaderSettingsSuperPanel,temporary:""},null,8,["panel"])],64)}const ya=m(ba,[["render",Pa],["__scopeId","data-v-dff2aac6"]]);export{ya as default};

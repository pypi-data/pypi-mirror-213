"use strict";(globalThis["webpackChunkqPhotobooth"]=globalThis["webpackChunkqPhotobooth"]||[]).push([[706],{666:(e,i,t)=>{t.d(i,{Z:()=>W});var r=t(9835),a=t(6970);const l={class:"q-mr-sm"},n={class:"q-mr-sm"},o={class:"absolute-bottom-left text-subtitle2"},s={class:"q-gutter-sm"};function d(e,i,t,d,m,c){const u=(0,r.up)("q-btn"),g=(0,r.up)("q-space"),h=(0,r.up)("q-icon"),p=(0,r.up)("q-toolbar"),S=(0,r.up)("q-linear-progress"),w=(0,r.up)("q-header"),y=(0,r.up)("q-img"),v=(0,r.up)("q-drawer"),I=(0,r.up)("q-carousel-slide"),f=(0,r.up)("q-carousel"),b=(0,r.up)("vue-qrcode"),k=(0,r.up)("q-page-sticky"),q=(0,r.up)("q-page-container"),_=(0,r.up)("q-layout"),T=(0,r.Q2)("close-popup"),R=(0,r.Q2)("touch-swipe");return(0,r.wg)(),(0,r.j4)(_,{view:"hhh Lpr ffr",onClick:c.abortTimer},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{elevated:"",class:"bg-primary text-white"},{default:(0,r.w5)((()=>[(0,r.Wm)(p,null,{default:(0,r.w5)((()=>[(0,r.wy)((0,r.Wm)(u,{dense:"",flat:"",icon:"close"},null,512),[[T]]),(0,r.Wm)(g),d.uiSettingsStore.uiSettings.gallery_show_delete?(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{key:0,flat:"",class:"q-mr-sm",icon:"delete",label:"Delete",onClick:i[0]||(i[0]=e=>c.deleteImage(d.currentSlideId))},null,512)),[[T]]):(0,r.kq)("",!0),d.uiSettingsStore.uiSettings.gallery_show_download?((0,r.wg)(),(0,r.j4)(u,{key:1,flat:"",class:"q-mr-sm",icon:"download",label:"Download",onClick:i[1]||(i[1]=e=>{d.openURL(t.itemRepository[d.currentSlideIndex]["full"])})})):(0,r.kq)("",!0),d.uiSettingsStore.uiSettings.gallery_show_print?((0,r.wg)(),(0,r.j4)(u,{key:2,flat:"",class:"q-mr-sm",icon:"print",label:"Print"})):(0,r.kq)("",!0),d.uiSettingsStore.uiSettings.gallery_show_filter?((0,r.wg)(),(0,r.j4)(u,{key:3,flat:"",class:"q-mr-sm",icon:"filter",label:"Filter",onClick:d.toggleRightDrawer},null,8,["onClick"])):(0,r.kq)("",!0),(0,r.Wm)(g),(0,r._)("div",l,[(0,r.Wm)(h,{name:"tag"}),(0,r._)("span",null,(0,a.zw)(d.currentSlideIndex+1)+" of "+(0,a.zw)(t.itemRepository.length)+" total",1)]),(0,r.Wm)(g),(0,r._)("div",n,[(0,r.Wm)(h,{name:"image"}),(0,r.Uk)(" "+(0,a.zw)(t.itemRepository[d.currentSlideIndex]["caption"]),1)])])),_:1}),m.displayLinearProgressBar&&m.remainingSeconds>0?((0,r.wg)(),(0,r.j4)(S,{key:0,value:m.remainingSecondsNormalized,"animation-speed":"200",color:"grey"},null,8,["value"])):(0,r.kq)("",!0)])),_:1}),d.uiSettingsStore.uiSettings.gallery_show_filter?((0,r.wg)(),(0,r.j4)(v,{key:0,modelValue:d.rightDrawerOpen,"onUpdate:modelValue":i[2]||(i[2]=e=>d.rightDrawerOpen=e),side:"right",elevated:"",overlay:""},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(m.availableFilter,(e=>((0,r.wg)(),(0,r.j4)(y,{src:`/mediaprocessing/preview/${d.currentSlideId}/${e}`,key:e,onClick:i=>c.applyFilter(d.currentSlideId,e)},{default:(0,r.w5)((()=>[(0,r._)("div",o,(0,a.zw)(e),1)])),_:2},1032,["src","onClick"])))),128))])),_:1},8,["modelValue"])):(0,r.kq)("",!0),(0,r.Wm)(q,{class:"q-pa-none galleryimagedetail full-height"},{default:(0,r.w5)((()=>[(0,r.wy)(((0,r.wg)(),(0,r.j4)(f,{class:"bg-image",style:{width:"100%",height:"100%"},"control-type":"flat","control-color":"primary",swipeable:"",animated:"",modelValue:d.currentSlideId,"onUpdate:modelValue":i[3]||(i[3]=e=>d.currentSlideId=e),thumbnails:"",autoplay:d.autoplay,draggable:"false",arrows:"","transition-prev":"slide-right","transition-next":"slide-left",onTransition:i[4]||(i[4]=(e,i)=>{d.currentSlideIndex=t.itemRepository.findIndex((i=>i.id===e)),c.abortTimer()})},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(c.slicedImages,(e=>((0,r.wg)(),(0,r.j4)(I,{"img-src":e.preview,key:e.id,name:e.id},null,8,["img-src","name"])))),128))])),_:1},8,["modelValue","autoplay"])),[[R,d.handleSwipeDown,void 0,{mouse:!0,down:!0}]]),(0,r.Wm)(k,{position:"top-right",offset:[30,30]},{default:(0,r.w5)((()=>[(0,r._)("div",s,[(0,r.Wm)(b,{type:"image/png",tag:"svg",margin:2,width:200,"error-correction-level":"low",color:{dark:"#111111",light:"#EEEEEE"},value:c.getImageQrData()},null,8,["value"])])])),_:1})])),_:1})])),_:1},8,["onClick"])}t(9665);var m=t(528),c=t(499),u=t(6694),g=t(3752);const h={props:{indexSelected:{type:Number,required:!0},itemRepository:{type:Array,required:!0}},computed:{slicedImages(){this.itemRepository.length;var e=Math.max(0,this.currentSlideIndex-2),i=Math.max(0,this.currentSlideIndex+3);return this.itemRepository.slice(e,i)}},beforeCreate(){console.log(this.indexSelected),this.currentSlideIndex=this.indexSelected,this.currentSlideId=this.itemRepository[this.indexSelected].id},data(){return{intervalTimerId:null,remainingSeconds:0,remainingSecondsNormalized:0,displayLinearProgressBar:!0,availableFilter:["original","_1977","aden","brannan","brooklyn","clarendon","earlybird","gingham","hudson","inkwell","kelvin","lark","lofi","maven","mayfair","moon","nashville","perpetua","reyes","rise","slumber","stinson","toaster","valencia","walden","willow","xpro2"]}},setup(){const e=(0,u.R)(),i=(0,c.iH)(!1);return{uiSettingsStore:e,openURL:g.Z,fabRight:(0,c.iH)(!1),currentSlideId:(0,c.iH)(""),currentSlideIndex:(0,c.iH)(0),autoplay:(0,c.iH)(!1),showFilterDialog:(0,c.iH)(!1),rightDrawerOpen:i,toggleRightDrawer(){i.value=!i.value},handleSwipeDown({evt:e}){console.log("TODO: add method to close dialog programmatically")}}},components:{VueQrcode:m.ZP},mounted(){this.startTimer()},beforeUnmount(){clearInterval(this.intervalTimerId)},methods:{async reloadImg(e){await fetch(e,{cache:"reload",mode:"no-cors"});const i=(new Date).getTime();document.body.querySelectorAll(`img[src*='${e}']`).forEach((t=>{t.src=e+"?"+i})),document.body.querySelectorAll(`div[style*="background-image"][style*="${e}"]`).forEach((t=>t.style.backgroundImage=`url(${e}?${i})`))},applyFilter(e,i){this.$api.get(`/mediaprocessing/applyfilter/${e}/${i}`).then((i=>{const t=this.itemRepository.findIndex((i=>i.id===e));this.reloadImg(this.itemRepository[t].full),this.reloadImg(this.itemRepository[t].preview),this.reloadImg(this.itemRepository[t].thumbnail)})).catch((e=>console.log(e)))},deleteImage(e){this.$api.get("/mediacollection/delete",{params:{image_id:e}}).then((e=>{console.log(e),this.itemRepository.splice(this.currentSlideIndex,1)})).catch((e=>console.log(e)))},getImageDetail(e,i="thumbnail"){return this.itemRepository[e][i]},getImageQrData(){const e=String(this.uiSettingsStore.uiSettings.EXT_DOWNLOAD_URL).replace("{filename}",this.itemRepository[this.currentSlideIndex]["filename"]);return e},abortTimer(){clearInterval(this.intervalTimerId),this.remainingSeconds=0,this.remainingSecondsNormalized=0},startTimer(){var e=this.uiSettingsStore.uiSettings["AUTOCLOSE_NEW_ITEM_ARRIVED"];console.log(`starting newitemarrived timer, duration=${e}`),this.remainingSeconds=e,this.intervalTimerId=setInterval((()=>{this.remainingSecondsNormalized=this.remainingSeconds/e,this.remainingSeconds-=.05,this.remainingSeconds<=0&&(clearInterval(this.intervalTimerId),this.$router.push({path:"/"}))}),50)}}};var p=t(1639),S=t(7605),w=t(6602),y=t(1663),v=t(8879),I=t(136),f=t(2857),b=t(8289),k=t(906),q=t(335),_=t(2133),T=t(7052),R=t(1694),D=t(627),Z=t(2146),x=t(4871),Q=t(9984),C=t.n(Q);const E=(0,p.Z)(h,[["render",d],["__scopeId","data-v-41e04494"]]),W=E;C()(h,"components",{QLayout:S.Z,QHeader:w.Z,QToolbar:y.Z,QBtn:v.Z,QSpace:I.Z,QIcon:f.Z,QLinearProgress:b.Z,QDrawer:k.Z,QImg:q.Z,QPageContainer:_.Z,QCarousel:T.Z,QCarouselSlide:R.Z,QPageSticky:D.Z}),C()(h,"directives",{ClosePopup:Z.Z,TouchSwipe:x.Z})},4706:(e,i,t)=>{t.r(i),t.d(i,{default:()=>S});var r=t(9835);function a(e,i,t,a,l,n){const o=(0,r.up)("q-linear-progress"),s=(0,r.up)("gallery-image-detail"),d=(0,r.up)("q-dialog"),m=(0,r.up)("q-page");return(0,r.wg)(),(0,r.j4)(m,{class:"q-pa-none fullscreen",onClick:n.abortTimer},{default:(0,r.w5)((()=>[l.displayLinearProgressBar?((0,r.wg)(),(0,r.j4)(o,{key:0,value:l.remainingSecondsNormalized,"animation-speed":"200"},null,8,["value"])):(0,r.kq)("",!0),(0,r.Wm)(d,{"transition-show":"jump-up","transition-hide":"jump-down",modelValue:l.showImageDetail,"onUpdate:modelValue":i[0]||(i[0]=e=>l.showImageDetail=e),maximized:""},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{itemRepository:[this.store.gallery.newArrivalItem],indexSelected:0,class:"full-height"},null,8,["itemRepository"])])),_:1},8,["modelValue"])])),_:1},8,["onClick"])}t(9665);var l=t(7575),n=t(6694),o=t(666);const s={components:{GalleryImageDetail:o.Z},data(){return{intervalTimerId:null,remainingSeconds:0,remainingSecondsNormalized:0,displayLinearProgressBar:!0,showImageDetail:!0}},setup(){const e=(0,l.h)(),i=(0,n.R)();return{store:e,uiSettingsStore:i,GalleryImageDetail:o.Z}},mounted(){this.startTimer()},beforeUnmount(){clearInterval(this.intervalTimerId)},methods:{abortTimer(){clearInterval(this.intervalTimerId),this.remainingSeconds=0,this.remainingSecondsNormalized=0},startTimer(){var e=this.uiSettingsStore.uiSettings["AUTOCLOSE_NEW_ITEM_ARRIVED"];console.log(`starting newitemarrived timer, duration=${e}`),this.remainingSeconds=e,this.intervalTimerId=setInterval((()=>{this.remainingSecondsNormalized=this.remainingSeconds/e,this.remainingSeconds-=.05,this.remainingSeconds<=0&&(clearInterval(this.intervalTimerId),this.$router.push({path:"/"}))}),50)}}};var d=t(1639),m=t(9885),c=t(8289),u=t(2074),g=t(9984),h=t.n(g);const p=(0,d.Z)(s,[["render",a]]),S=p;h()(s,"components",{QPage:m.Z,QLinearProgress:c.Z,QDialog:u.Z})}}]);
import{l as X,r as k,c as j,a2 as ae,Q as te,q as r,v as c,x as i,j as s,M as b,K as w,N as v,A,k as ie,L as I,aq as ne,ar as B,J as oe,w as se,y as _,z as N,F as D,B as F,O as d,S as h,a6 as G,as as re,at as $,a0 as L}from"./index-11e01e27.js";import{_ as J,e as ue,p as de}from"./MediaItemThumb.vue_vue_type_style_index_0_lang-c919923a.js";import{L as M,V as pe,_ as me}from"./ProviderIcon.vue_vue_type_script_setup_true_lang-0ce5ab95.js";import{b as ce,V as R}from"./VMenu-6f4b0d2a.js";import{V as fe,a as ye,b as E,P as be}from"./ListviewItem.vue_vue_type_script_setup_true_lang-a96ef087.js";import{d as ve,i as q,c as W,g as U,a as x}from"./VCard-4c75536f.js";import{V as S,l as H}from"./VBtn-ba18d485.js";import{V as ge,b as Q}from"./VToolbar-685b17bc.js";import{V as _e}from"./index-688be463.js";import{a as he,V as ke}from"./VSelect-7925881f.js";import{V as Ae}from"./VDialog-06407d5a.js";const qe=X({__name:"PanelviewItem",props:{item:{},size:{default:200},isSelected:{type:Boolean},showCheckboxes:{type:Boolean,default:!1},showTrackNumber:{type:Boolean,default:!0}},emits:["menu","click","select"],setup(e,{emit:n}){const l=e,p=k(!1),g=j(()=>{for(const a of l.item.provider_mappings)if(a.content_type!=null&&a.content_type in[B.DSF,B.FLAC,B.AIFF,B.WAV]&&(a.sample_rate>48e3||a.bit_depth>16))return`${a.sample_rate}kHz ${a.bit_depth} bits`;return""});return(a,f)=>{const V=ae("hold");return te((r(),c(W,{class:"panel-item",onClick:f[1]||(f[1]=y=>a.showCheckboxes?null:n("click",a.item)),onContextmenu:f[2]||(f[2]=ne(y=>a.showCheckboxes?null:n("menu",a.item),["right","prevent"])),onMouseover:f[3]||(f[3]=y=>p.value=!0),onMouseleave:f[4]||(f[4]=y=>p.value=!0)},{default:i(()=>[a.showCheckboxes?(r(),c(ce,{key:0,"model-value":a.showCheckboxes,contained:"",scrim:a.isSelected?a.$vuetify.theme.current.dark?"rgba(0,0,0,.75)":"rgba(255,255,255,.75)":"#ffffff00",onClick:f[0]||(f[0]=y=>{n("select",a.item,!a.isSelected)})},{default:i(()=>[s(fe,{class:"panel-item-checkbox",ripple:!1,"model-value":a.isSelected},null,8,["model-value"])]),_:1},8,["model-value","scrim"])):b("",!0),s(J,{item:a.item,width:"100%"},null,8,["item"]),s(M,{style:{"padding-left":"0px !important","padding-right":"0px !important","padding-top":"10px !important"}},{default:i(()=>[s(ve,{class:"line-clamp-1"},{default:i(()=>[w(v(a.item.name)+" "+v("version"in a.item&&a.item.version?`- ${a.item.version}`:""),1)]),_:1}),"artists"in a.item&&a.item.artists?(r(),c(q,{key:0,class:"line-clamp-1"},{default:i(()=>[w(v(A(ue)(a.item.artists,1)),1)]),_:1})):"owner"in a.item&&a.item.owner?(r(),c(q,{key:1,class:"line-clamp-1"},{default:i(()=>[w(v(a.item.owner),1)]),_:1})):b("",!0),a.item&&a.item.media_type==="track"?(r(),c(ye,{key:2,style:{"min-height":"22px","padding-top":"5px"}},{default:i(()=>[s(E,null,{default:i(()=>[A(de)(a.item.metadata.explicit||!1)?(r(),c(S,{key:0,icon:"mdi-alpha-e-box"})):b("",!0)]),_:1}),s(E,null,{default:i(()=>[g.value?(r(),c(pe,{key:0,bottom:""},{activator:i(({props:y})=>[s(S,ie(y,{icon:"mdi-quality-high"}),null,16)]),default:i(()=>[I("span",null,v(g.value),1)]),_:1})):b("",!0)]),_:1}),"disc_number"in a.item&&a.item.disc_number&&a.showTrackNumber?(r(),c(E,{key:0},{default:i(()=>[s(S,{style:{"margin-left":"5px"},icon:"md:album"}),w(" "+v(a.item.disc_number),1)]),_:1})):b("",!0),"track_number"in a.item&&a.item.track_number&&a.showTrackNumber?(r(),c(E,{key:1},{default:i(()=>[s(S,{style:{"margin-left":"5px"},icon:"mdi-music-circle-outline"}),w(" "+v(a.item.track_number),1)]),_:1})):b("",!0)]),_:1})):b("",!0)]),_:1})]),_:1})),[[V,()=>a.showCheckboxes?null:n("menu",a.item)]])}}});const Ve={key:0},Ce={class:"media-thumb"},we={key:0},P=function(e){var n;for(const l of e.provider_mappings)if(l.available&&((n=d.providers[l.provider_instance])!=null&&n.available))return!0;return!1},Ie=function(e){var n;for(const l of e.provider_mappings)if((n=d.providers[l.provider_instance])!=null&&n.supported_features.includes(G.SIMILAR_TRACKS))return!0;return!1},Pe=function(e,n){const l=[];if(e.length==0||!P(e[0]))return l;let p=$.PLAY,g=$.NEXT;return(e.length>10||[h.ALBUM,h.PLAYLIST].includes(e[0].media_type))&&(p=$.REPLACE,g=$.REPLACE_NEXT),e.length==1&&n&&n.media_type==h.PLAYLIST&&l.push({label:"play_playlist_from",action:()=>{d.playPlaylistFromIndex(n,e[0].position||0)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),e.length==1&&n&&n.media_type==h.ALBUM&&l.push({label:"play_album_from",action:()=>{d.playAlbumFromItem(n,e[0])},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),l.push({label:"play_now",action:()=>{d.playMedia(e,p)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),Ie(e[0])&&l.push({label:"play_radio",action:()=>{d.playMedia(e,p,!0)},icon:"mdi-radio-tower",labelArgs:[],actionStr:"play"}),(e.length===1||e[0].media_type===h.TRACK)&&l.push({label:"play_next",action:()=>{d.playMedia(e,g)},icon:"mdi-skip-next-circle-outline",labelArgs:[],actionStr:"play"}),l.push({label:"add_queue",action:()=>{d.playMedia(e,$.ADD)},icon:"mdi-playlist-plus",labelArgs:[],actionStr:"play"}),l},Se=function(e,n){const l=[];if(e.length==0)return l;if(e.length===1&&e[0]!==n&&P(e[0])&&l.push({label:"show_info",labelArgs:[],action:()=>{var p;L.push({name:e[0].media_type,params:{itemId:e[0].item_id,provider:e[0].provider},query:{album:"album"in e[0]?(p=e[0].album)==null?void 0:p.uri:""}})},icon:"mdi-information-outline"}),e.length===1&&P(e[0])&&"artists"in e[0]&&e[0].artists.length===1)for(const p of e[0].artists)l.push({label:"goto_artist",labelArgs:[p.name],action:()=>{L.push({name:"artist",params:{itemId:p.item_id,provider:p.provider}})},icon:"mdi-account-music"});if(e.length===1&&P(e[0])&&"album"in e[0]&&e[0].album&&l.push({label:"goto_album",labelArgs:[e[0].album.name],action:()=>{L.push({name:"album",params:{itemId:e[0].album.item_id,provider:e[0].album.provider}})},icon:"mdi-album"}),e.length===1&&(e[0]==n||!P(e[0]))&&l.push({label:"refresh_item",labelArgs:[],action:async()=>{await d.refreshItem(e[0]),L.go(0)},icon:"mdi-refresh"}),!e[0].in_library&&P(e[0])&&l.push({label:"add_library",labelArgs:[],action:()=>{d.addItemsToLibrary(e)},icon:"mdi-heart-outline"}),e[0].in_library&&l.push({label:"remove_library",labelArgs:[],action:()=>{d.removeItemsFromLibrary(e)},icon:"mdi-heart"}),n&&n.media_type===h.PLAYLIST){const p=n;e[0].media_type===h.TRACK&&p.is_editable&&l.push({label:"remove_playlist",labelArgs:[],action:()=>{d.removePlaylistTracks(p.item_id,e.map(g=>g.position))},icon:"mdi-minus-circle-outline"})}return e[0].media_type==="track"&&l.push({label:"add_playlist",labelArgs:[],actionStr:"add_playlist",icon:"mdi-plus-circle-outline"}),e.length==1&&e[0].provider=="database"&&l.push({label:"delete_db",labelArgs:[],action:()=>{d.deleteDbItem(e[0].media_type,e[0].item_id,!0),n&&n.item_id==e[0].item_id&&L.push({name:`${n.media_type}s`})},icon:"mdi-cancel"}),e.length>1&&l.push({label:"clear_selection",labelArgs:[],actionStr:"clear",icon:"mdi-cancel"}),l},Ke=X({__name:"MediaItemContextMenu",props:{items:{},parentItem:{default:void 0},modelValue:{type:Boolean},enablePlayItems:{type:Boolean,default:!0},enableActionMenuItems:{type:Boolean,default:!0},fullscreen:{type:Boolean,default:!0}},emits:["refresh","clear","update:modelValue","update:items"],setup(e,{emit:n}){const l=e,{t:p}=oe(),g=k([]),a=k([]),f=k(""),V=k([]),y=k(!1),K=k("");se(()=>l.modelValue,t=>{t&&Z()});const Z=async function(){if(y.value=!1,V.value=[],!l.items)return;l.items.length===1?f.value=l.items[0].name:f.value=p("items_selected",[l.items.length]).toString(),F.selectedPlayer&&F.selectedPlayer.available?a.value=Pe(l.items,l.parentItem):a.value=[];let t=l.items[0],u=0;if("position"in t&&(u=t.position),t.provider!=="database"){try{t=await d.getItemByUri(l.items[0].uri)}catch{t=l.items[0]}"position"in t&&(t.position=u);const o=l.items;o[0]=t,n("update:items",o)}g.value=Se(l.items,l.parentItem),ee()},ee=async function(){V.value=[];const t=await d.getPlaylists();for(const u of t.items)u.is_editable&&!(l.parentItem&&l.parentItem.media_type===h.PLAYLIST&&u.item_id===l.parentItem.item_id)&&V.value.push(u)},Y=function(t){d.addPlaylistTracks(t.item_id,l.items.map(u=>u.uri)),T()},z=async function(t){const u=await d.createPlaylist(K.value,t);Y(u)},O=async function(t){t.actionStr=="add_playlist"?y.value=!0:t.actionStr=="clear"?(n("clear"),T()):t.action&&t.actionStr=="play"?(t.action(),n("clear"),T()):t.action&&(T(),t.action())},T=function(){l.items.length==1&&n("clear"),n("update:modelValue",!1)},le=j(()=>{var u,o;const t=[];for(const m in(u=d)==null?void 0:u.players){const C=(o=d)==null?void 0:o.players[m];C.synced_to||t.push({title:C.display_name,value:C.player_id})}return t.slice().sort((m,C)=>m.title.toUpperCase()>C.title.toUpperCase()?1:-1)});return(t,u)=>(r(),c(Ae,{"model-value":t.modelValue,fullscreen:t.$vuetify.display.mobile,"min-height":"80%",scrim:!0,"onUpdate:modelValue":u[3]||(u[3]=o=>t.$emit("update:modelValue",o))},{default:i(()=>[s(W,null,{default:i(()=>[s(ge,{color:"transparent",style:{padding:"10px 0px"},density:"compact",class:"titlebar"},{default:i(()=>[s(H,{icon:"mdi-play-circle-outline"}),y.value?(r(),c(Q,{key:0,style:{"padding-left":"10px"}},{default:i(()=>[I("b",null,v(t.$t("add_playlist")),1),t.$vuetify.display.mobile?b("",!0):(r(),_("span",Ve," | "+v(f.value),1))]),_:1})):(r(),c(Q,{key:1,style:{"padding-left":"10px"}},{default:i(()=>[I("b",null,v(f.value),1)]),_:1})),s(H,{icon:"mdi-close",dark:"",onClick:u[0]||(u[0]=o=>T())})]),_:1}),s(_e),t.enablePlayItems&&!y.value&&a.value.length>0?(r(),c(U,{key:0},{default:i(()=>{var o;return[s(he,{label:t.$t("play_on"),"model-value":(o=A(F).selectedPlayer)==null?void 0:o.player_id,items:le.value,"hide-details":"","onUpdate:modelValue":u[1]||(u[1]=m=>{A(F).selectedPlayer=A(d).players[m]})},null,8,["label","model-value","items"]),s(R,null,{default:i(()=>[(r(!0),_(D,null,N(a.value,m=>(r(),_("div",{key:m.label},[s(M,{title:t.$t(m.label,m.labelArgs),density:"default",onClick:C=>O(m)},{prepend:i(()=>[s(x,{style:{"padding-right":"10px"}},{default:i(()=>[s(S,{icon:m.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"])]))),128))]),_:1})]}),_:1})):b("",!0),t.enableActionMenuItems&&!y.value&&g.value.length>0?(r(),c(U,{key:1,style:{"padding-top":"0","margin-top":"-10px","padding-bottom":"0"}},{default:i(()=>[s(q,{style:{"margin-left":"10px"}},{default:i(()=>[w(v(t.$t("actions")),1)]),_:1}),s(R,null,{default:i(()=>[(r(!0),_(D,null,N(g.value,o=>(r(),_("div",{key:o.label},[s(M,{title:t.$t(o.label,o.labelArgs),density:"default",onClick:m=>O(o)},{prepend:i(()=>[s(x,{style:{"padding-right":"10px"}},{default:i(()=>[s(S,{icon:o.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"])]))),128))]),_:1})]),_:1})):b("",!0),y.value?(r(),c(U,{key:2},{default:i(()=>[s(R,null,{default:i(()=>[(r(!0),_(D,null,N(V.value,o=>(r(),_("div",{key:o.item_id},[s(M,{ripple:"",density:"default",onClick:m=>Y(o)},{prepend:i(()=>[I("div",Ce,[s(J,{item:o,size:50,width:"50px",height:"50px"},null,8,["item"])])]),title:i(()=>[I("div",null,v(o.name),1)]),subtitle:i(()=>[I("div",null,v(o.owner),1)]),append:i(()=>[o.provider_mappings?(r(),c(be,{key:0,"provider-mappings":o.provider_mappings,height:20},null,8,["provider-mappings"])):b("",!0)]),_:2},1032,["onClick"])]))),128)),(r(!0),_(D,null,N(A(d).providers,o=>(r(),_("div",{key:o.instance_id},[o.supported_features.includes(A(G).PLAYLIST_CREATE)?(r(),_("div",we,[s(M,{ripple:""},{prepend:i(()=>[s(me,{domain:o.domain,size:"40px",class:"media-thumb"},null,8,["domain"])]),title:i(()=>[s(ke,{label:t.$t("create_playlist",[o.name]),"append-icon":"mdi-playlist-plus",variant:"plain","hide-details":"","onUpdate:modelValue":u[2]||(u[2]=m=>{K.value=m}),"onClick:append":m=>z(o.instance_id),onKeydown:re(m=>z(o.instance_id),["enter"])},null,8,["label","onClick:append","onKeydown"])]),_:2},1024)])):b("",!0)]))),128))]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["model-value","fullscreen"]))}});export{Ke as _,qe as a,Pe as b,Se as g,P as i};
